# ============================================================================
# RAX3000M (MTK7981B) OpenWrt 24.10 - BBRv3 & TCP 终极优化参数
# ============================================================================

net.core.default_qdisc = fq

# --- 网络缓冲区优化 (融合方案) ---
# 最大缓冲区大小 (采用您的值，非常合理)
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
# 默认缓冲区大小 (我的建议：不设置默认值，或使用系统动态调整)
# net.core.rmem_default = 67108864
# net.core.wmem_default = 67108864
# TCP动态调整范围 (最小值、默认值、最大值)。您的最大值很好，我调整了默认值以更均衡。
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
# 全局TCP内存限制 (三个值：低、压力、高)。根据512MB内存调整，预防内存耗尽。
net.ipv4.tcp_mem = 65536 131072 262144

# --- 连接处理与性能 (主要采用您的优秀参数) ---
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_timestamps = 1
net.ipv4.tcp_sack = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_max_syn_backlog = 8192
net.core.netdev_max_backlog = 32768
net.core.somaxconn = 32768
# 减少TIME_WAIT状态的等待时间，加速端口回收
net.ipv4.tcp_fin_timeout = 30
# 禁用空闲后的慢启动，保持高速状态
net.ipv4.tcp_slow_start_after_idle = 0

# --- 连接跟踪优化 (您的关键优化，对NAT性能至关重要) ---
net.netfilter.nf_conntrack_max = 131072
net.netfilter.nf_conntrack_expect_max = 2048

# --- 邻居表(ARP)优化 (融合方案) ---
net.ipv4.neigh.default.gc_stale_time = 120
net.ipv4.neigh.default.gc_interval = 1800
# 增加ARP表容量，防止在设备多的网络中丢表
net.ipv4.neigh.default.gc_thresh1 = 2048
net.ipv4.neigh.default.gc_thresh2 = 4096
net.ipv4.neigh.default.gc_thresh3 = 8192

# --- 虚拟内存优化 (采用您的参数，适合路由器) ---
vm.swappiness = 10
vm.vfs_cache_pressure = 50